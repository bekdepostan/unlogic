<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Sven Steinbauer">


        <title>"Infosec Institute CTF2.0"</title>

        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/monokai.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="The folks over at the Infosec Institue have released their second CTF. Here's how I got on... Contents * Auto generated table of ...">

        <meta name="author" content="Sven Steinbauer">

        <meta name="tags" content="[infosec">
        <meta name="tags" content="ctf">
        <meta name="tags" content="n00bs">
        <meta name="tags" content="walkthrough">
        <meta name="tags" content="solution">
        <meta name="tags" content="capture the flag]">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Unlogic">

	<meta property="og:type" content="article">
            <meta property="article:author" content="Sven Steinbauer" >
	<meta property="og:url" content="/2015/06/25/infosec-institute-ctf20/">
	<meta property="og:title" content=""Infosec Institute CTF2.0"">
	<meta property="article:published_time" content="2015-06-25 00:00:00+01:00">
            <meta property="og:description" content="The folks over at the Infosec Institue have released their second CTF. Here's how I got on... Contents * Auto generated table of ...">

            <meta property="og:image" content="/images/keyboard-feature.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Unlogic</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                            <li><a href="/pages/about.html">About</a></li>
                            <li><a href="/pages/all-posts.html">All posts</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <header class="intro-header" style="background-image: url('/images/keyboard-feature.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>"Infosec Institute CTF2.0"</h1>
                        <span class="meta">Posted by
                                <a href="/author/sven-steinbauer.html">Sven Steinbauer</a>
                             on Thu 25 June 2015
                        </span>
                            <span class="meta">Updated on Mon 06 July 2015</span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>The folks over at the <a href="https://infosecinstitute.com">Infosec Institue</a> have released
their <a href="http://ctf.infosecinstitute.com/ctf2/">second CTF</a>. Here's how I got on...</p>
<section id="table-of-contents" class="toc">
<header>
<h3>Contents</h3>
</header>
<div id="drawer" markdown="1">
*  Auto generated table of contents
{:toc}
</div>
</section>

<!-- /#table-of-contents -->

<h1>Level 01</h1>
<p>In <a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex1.php">level 01</a> I am supposed
to use the provided form to perform a cross site scripting exploit. Here's what the form
looks like:</p>
<p>{% img http://i.imgur.com/CJTNyK4.png %}</p>
<p>At first I might as well test how the form works. Entering something like <code>test</code> and
<code>www.test.com</code> in the fields simply adds the supplied information to the column on the left.
So I try the usual XSS payload: <code>&lt;script&gt;alert("Ex1");&lt;/script&gt;</code> in the <code>Site Name</code> field.</p>
<p>A popup tells me that I need to <em>match the requested format</em>. Probably some client side
checks, so I inspect the field with Firebug and notice this:</p>
<p>{% img http://i.imgur.com/f5KzFDx.png %}</p>
<p>The field has a regular expression premitting only upper or lowercase characters. I can either
delete this or just change it to <code>.+</code> so it matches any character.</p>
<p>Now resubmitting the XSS payload works and the string is reflected on the page:</p>
<p>{% img http://i.imgur.com/yvSc4To.png %}</p>
<p>However, there's no pop up. So there must be something else validating input. Heading back to the
source I find some javscript in <code>ex1.js</code> which contains the following code:</p>
<p><a href="http://i.imgur.com/VVe74tW.png">{% img http://i.imgur.com/VVe74tW.png %}</a></p>
<p>The <code>siteName</code> variable has all <code>&lt;</code> and <code>&gt;</code> characters replaced with their equivalent html codes.
By clicking on the gutter in the source code I set a breakpoint on the line that does this, and resubmit
my data. The Firebug debugger breaks on the line and I step over it. Sure enough <code>siteName</code> is not
what I want it to be. Double clicking on the value in the right hand window allows me to edit it, and 
revert it back to what I want it to be. Then clicking continue I am rewarded with:</p>
<p>{% img http://i.imgur.com/VEFDpio.png %}</p>
<h1>Level 02</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex2.php">Level 02</a> is a simple web calculator:</p>
<p>{% img http://i.imgur.com/asgTWCw.png %}</p>
<p>I'm supposed to use the form to print <code>phpinfo</code> or other data to the page. This is a PHP
script evaluating a simple expression. I am guessing that it's going to be calling <code>eval</code>, as
that's a fairly common vulnerability, and fits to how the page works. After entering some numbers
and other characters into the two fields I quickly learn that the input for those fields is checked.
That means I can't enter anything but numbers into those fields. That leaves the operator as the only 
other thing under our control. </p>
<p>I'm going to guess that code looks somewhat like this:</p>
<p _="%" endhighlight="endhighlight">{% highlight php %}
eval ("print $num1 $op $num2;");</p>
<p>So I need to change the operand to something that prints <code>phpinfo</code> but leaves the rest of the statement
valid. With Firebug I can edit the value of the operand to the following:</p>
<p>{% img http://i.imgur.com/8xnqMxv.png %}</p>
<p>Hit submit and....</p>
<p>{% img http://i.imgur.com/rUgaixe.png %}</p>
<h1>Level 03</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex3.php">Level 03</a> provides me with a registration
form and a login form. The instructions indicate that the data is stored in a delimited file and I need
to sign up as a new user with admin rights.</p>
<p>{% img http://i.imgur.com/f0g5TmV.png %}</p>
<p>First things first, let's see if we can figure out the delimiter... Signing up and logging in
shows us our name and current role: <code>role:normal</code>. This already tells me that the delimiter is not
<code>:</code>. After fuzzing the input it turns out most characters are ok to use. So what's the delimeter?
I check the hints and it tells me that it's the newline character. Interesting, in my fuzzing I tried that,
but had no luck. Unless..</p>
<p>So let's not use <code>\n</code> but a real new line. I can achieve this by editing the source with Firebug
once again, changing the <code>lastname</code> field to a <code>textarea</code> type:</p>
<p><a href="http://i.imgur.com/QBVptMv.png">{% img http://i.imgur.com/QBVptMv.png %}</a></p>
<p>Now I can have multiple lines and enter a real carriage return into the field. My last
name will be</p>
<p _="%" endhighlight="endhighlight">{% highlight console %}
alpha7
role:admin</p>
<p>And after a login with the new creds:</p>
<p>{% img http://i.imgur.com/Akj9NL8.png %}</p>
<h1>Level 04</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex4.php">Level 04</a> </p>
<p><a href="http://i.imgur.com/nmRe8U2.png">{% img http://i.imgur.com/nmRe8U2.png %}</a></p>
<p>Here we need to load a php file instead of the text files that load when you click
on the <em>Bio</em>, <em>Clients</em>, or <em>About</em> buttons. The instructions are very clear,
but it sounds like we need to load a phop file from the root of the domain. Let's
see what restrictions are in place.</p>
<p>Fuzzing the file parameter I notice that it seems to test for <code>fileNiXtxt</code> where <em>N</em> is
any number and <code>X</code> is any other character. Anything other than that pattern will print <code>Invalid file selected.</code>.</p>
<p>Entering <code>index.php;file1.txt</code> for example gives a different error: <code>There is something else that you must do.</code>.
Interesting. So I guess it just needs to be somewhere in that argument for the filter to accept it. But
how can we accomplish this with a valid payload?</p>
<p>One thing I tried was <code>/file1/txt/../../file.php</code> which wasn't right either. Here we make use
of relative paths where when PHP opens the file, it will ignore the fact that the path
<code>/file1/txt</code> doesn't exist and treat this as if <code>file.php</code> as at <code>/</code>. </p>
<p>UPDATE: Solved</p>
<p>So the key bit I was missing was that it wanted a remote, even if that remote is the
same domain as the current page. So I added <code>http://infosecinstitute.com/file3.php</code> as
the argument to get a new error: <em>You are trying to add a remote URL.</em> Ok, now we are getting somewhere.
As one of the hints is that the regex might be case sensitive, let's capitalise the <code>h</code> in <code>http</code>.
This time we get an <em>invalid file</em> message, so that bypass worked. Now we need to satisfy the
<code>file3.txt</code> requirement and using <code>Http://infosecinstitute.com/file3.txt.php</code> I get the flag</p>
<p><a href="http://i.imgur.com/WTFYtJi.png">{%img http://i.imgur.com/WTFYtJi.png %}</a></p>
<h1>Level 05</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex5.php">Level 05</a> starts by telling
me that I am not logged in. </p>
<p>{% img http://i.imgur.com/BOBdkHX.png %}</p>
<p>Well, I don't remember logging in, so that's not unusual. What is unusual is
that the <code>login</code> button doesn't work. I'll quickly check the source code and notice
that it's disabled, but also that it points to <code>login.html</code>. Enabling and clicking it
takes me to a 404, so no go. The vulnerability here is <em>Missing Function Level Access Control</em>
so perhaps this page assumes we're logged in if we are coming from the login page. Let's 
assume that if the user is successful on <code>login.html</code>, that page will redirect here, and then 
this page will just assume that the user is allowed to be here.</p>
<p>Using an intercepting proxy I'll edit the <code>Referer</code> field in the original request, so that
it appears to be coming from the login page:</p>
<p>{% img http://i.imgur.com/EK9u7Ir.png %}</p>
<p>Forward the request and</p>
<p>{% img http://i.imgur.com/QCisDvN.png %}</p>
<h1>Level 06</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex6.php">Level 06</a> shows a nice
big text area with allowable HTML tags.</p>
<p>{% img http://i.imgur.com/Waq1AVN.png %}</p>
<p>This time I need to perform a cross site request forgery. This can be accomlished by an <code>href</code>
tag, but trying this tells me that they are expecting something that will perform the request
without the need for user interaction. Ok, fine, let's revisit the allowed tags. <code>img</code> looks useful, right?</p>
<p>Let's try the following</p>
<p>{% img http://i.imgur.com/qCd5NUP.png %}</p>
<p>Yep, that's what we needed. </p>
<h1>Level 07</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex7.php">Level 07</a> is a login form on which
we need to perform another XSS attack. </p>
<p>{% img http://i.imgur.com/WO8dRpe.png %}</p>
<p>Well, lucky for me I perform these challenges through a proxy which unhides hidden fields like
the one you see there. Some investigation shows that the value of the hidden field comes from
a php_self value. That is it uses whatever the URL part is to populate the field, so that form
is submitted back to itself.</p>
<p>Using this we can inject something into the field to hopefully reflect our data on the page.
By employing the <code>arg</code> paramater we can close the <code>input</code> tag, and the inject our <code>h1</code> tags:</p>
<p _="%" endhighlight="endhighlight">{% highlight console %}
http://ctf.infosecinstitute.com/ctf2/exercises/ex7.php?arg='&gt;<h1>username</h1></p>
<p>Submitting that puts <code>username</code> on the page surrounded by <code>h1</code> tags and nabs the flag</p>
<h1>Level 08</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex8.php">Level 08</a></p>
<p>{% img http://i.imgur.com/610ZNNq.png %}</p>
<p>Here we need to upload an image that will produce a javscript alert. First things first with these
things I upload an image to see how it behaves. Once uploaded I click on the example links and notice that
images are fetched via an id. The URL is </p>
<p _="%" endhighlight="endhighlight">{% highlight console %}
http://ctf.infosecinstitute.com/ctf2/exercises/ex8.php?attachment_id=1</p>
<p>So let me see if I can access an image via another ID, for example <code>id=4</code>.
I get the message:</p>
<p _="%" endhighlight="endhighlight">{% highlight console %}
This attachment is currently under review by our editors. </p>
<p>So no. Checking out the image URL for one of the chess images shows me that the images
are stored at <code>http://ctf.infosecinstitute.com/ctf2/ex8_assets/img/chess1.png</code> for example.</p>
<p>I make a note of this.</p>
<p>Now can I just upload an html file? That gives me an error of an invalid file type. So let me chack
if it's just checking the extension or if there's something more happening. Intercepting the upload
request with Burp proxy I can change the extension to <code>jpg</code> and sucessfully upload the html file.</p>
<p>Now browsing to the image url I am told it cannot display the image due to errors. Well, the browser
is trying to interpret the file as an image, which it clearly isn't. There's got to be another way
to get at my image. How about the object reference in the URL <code>http://ctf.infosecinstitute.com/ctf2/exercises/ex8.php?attachment_id=1</code>
for example? Maybe if I just reference the filename directly?</p>
<p _="%" endhighlight="endhighlight">{% highlight console %}
http://ctf.infosecinstitute.com/ctf2/exercises/ex8.php?file=index.jpg</p>
<p>Success</p>
<p><a href="http://i.imgur.com/RVoJGMr.png">{ %img http://i.imgur.com/RVoJGMr.png %}</a></p>
<h1>Level 09</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex9.php">Level 09</a> starts off by showing me the 
details of one John Doe.</p>
<p>{% img http://i.imgur.com/8NESmpB.png %}</p>
<p>I need to change something to make it show the details for Mary Jane. There's no URL parms,
no login, so how can the page know who to show? There's one place left: the cookie jar.</p>
<p>Using Firebug once again I inspect the cookies and sure enough</p>
<p>{% img http://i.imgur.com/xGdtDa7.png %}</p>
<p>This is "JOHN+DOE" encoded as base64 as it turns out. One thing to note is when you</p>
<p _="%" endhighlight="endhighlight">{% highlight console %}
echo Sk9ITitET0u= | base64 -d</p>
<p>there is no newline at end of the name. So to encode <code>MARY+JANE</code> correctly I need to 
use echo with the <code>-n</code> flag:</p>
<p _="%" endhighlight="endhighlight">{% highlight console%}
$&gt; echo -n MARY+JANE | base64
TUFSWStKQU5F</p>
<p>Editing the cookie and inserting that base64 string will show us Mary Jane's details.</p>
<h1>Level 10</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex10.php">Level 10</a> is a game and we need to
edit its source so we look like we're really good at it.</p>
<p>{% img http://i.imgur.com/g03njlQ.png %}</p>
<p>Entering anything in the name I field I have a poke around to see how the whole thing
works. We're shown some coloured squares and then they are turn over. We need to then 
remember which colour each square had. Except we need to do it at least 9999 times and
at the extreme level, which only shows us the squares for a second.</p>
<p>Finding the square colours isn't hard. With Firebug we can see:</p>
<p>{% img http://i.imgur.com/isDO7LM.png %}</p>
<p>and those numbers are 0 indexed into the list of numbers from the selction popup. So playing
along I can win one game. So let's find out where my current win/loss count is stored.</p>
<p>In the Javscript I find a structure that does this:</p>
<p>{% img http://i.imgur.com/gZghIIn.png %}</p>
<p>but all this does is increment and decrement the values. Clearly that data is stored somewhere. 
Turns out that this <code>localstorage</code> is in the DOM. Using the <em>DOM</em> tab in Firebug I can find
the structure and its data:</p>
<p>{% img http://i.imgur.com/xGIZXpb.png %}</p>
<p>Now I can edit the number of wins and then, all I need to do is play one more game to take the flag.</p>
<h1>Level 11</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex11.php">Level 11</a> blacklists me</p>
<p>{% img http://i.imgur.com/RaGy98O.png %}</p>
<p>Awwwww I was having such fun. But how? Not from my IP, as that's going to change. First thing
to check: cookie jar. Yay!</p>
<p>{% img http://i.imgur.com/QgGrvwE.png %}</p>
<p>There it is, a big <code>no</code>. I'll change that to a <code>yes</code>, reload and take the flag, thanks very much.</p>
<h1>Level 12</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex12.php">Level 12</a> is a bruteforce challange. No 
login attempt limits, no rate limits, so it's ripe for the picking.</p>
<p>{% img http://i.imgur.com/LMUBNoq.png %}</p>
<p>After searching for the suggested password list, the first hit is the Openwall password list for
john the ripper. So why not download it and give it a try?</p>
<p>I fire up <code>wfuzz</code> with the following commandline</p>
<p _="%" endhighlight="endhighlight">{% highlight console %}
$&gt; wfuzz -c -z file,/usr/share/wordlists/password-2011.lst --hw Incorrect -d "username=admin&amp;password=FUZZ&amp;logIn=Login" "http://ctf.infosecinstitute.com/ctf2/exercises/ex12.php"</p>
<p>Within a few seconds I get a hit with <code>princess</code>. Enter that with the username <code>admin</code> and onto the next level</p>
<h1>Level 13</h1>
<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex13.php?redirect=ex13-task.php">Level 13</a> is actually
redirect to <code>ex13-task.php</code>. I need to make the redirect point to an external page so that to another user
it looks like they are visiting <code>ctf.infosecinstitute.com</code> but are infact taken to another site</p>
<p>{% img http://i.imgur.com/jNgQ4Ww.png %}</p>
<p>Well the obvious thing is just to try and type in another URL <code>http://ctf.infosecinstitute.com/ctf2/exercises/ex13.php?redirect=http://unlogic.co.uk</code>
but that gives me an error. Hrmm... trying a few other redirect options tells me that the redirect is URL 
relative, which means if I strip off the protocol off the URL, I should be able to make this work:</p>
<p><a href="http://i.imgur.com/QM7V8Dk.png">{% img http://i.imgur.com/QM7V8Dk.png %}</a></p>
<p>Sure enough, that worked. That's it, the final flag.</p>
<p>Thanks to the Infosec Institute for another great CTF!</p>
    </article>

        <div class="tags">
            <p>tags: <a href="/tag/infosec.html">[infosec</a>, <a href="/tag/ctf.html">ctf</a>, <a href="/tag/n00bs.html">n00bs</a>, <a href="/tag/walkthrough.html">walkthrough</a>, <a href="/tag/solution.html">solution</a>, <a href="/tag/capture-the-flag.html">capture the flag]</a>, </p>
        </div>

<hr>
<div class="sharing">
</div>
    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="#">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-you can add links in your config file fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-another social link fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

<script type="text/javascript">
    var disqus_shortname = 'unlogic';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>