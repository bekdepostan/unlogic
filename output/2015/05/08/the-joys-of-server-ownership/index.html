<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Sven Steinbauer">


        <title>The joys of server ownership</title>

            <link href="/post/index.xml" type="application/atom+xml" rel="alternate" title="Unlogic Atom Feed" />
            <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="Unlogic RSS Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/monokai.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="This post serves mostly as a "note to self". I just ordered myself a super cheap VPS from Ramnode as I have a little project I would ...">

        <meta name="author" content="Sven Steinbauer">


	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Unlogic">

	<meta property="og:type" content="article">
            <meta property="article:author" content="Sven Steinbauer" >
	<meta property="og:url" content="/2015/05/08/the-joys-of-server-ownership/">
	<meta property="og:title" content="The joys of server ownership">
	<meta property="article:published_time" content="2015-05-08 00:00:00+01:00">
            <meta property="og:description" content="This post serves mostly as a "note to self". I just ordered myself a super cheap VPS from Ramnode as I have a little project I would ...">

            <meta property="og:image" content="/images/keyboard-feature.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Unlogic</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                            <li><a href="/pages/about.html">About</a></li>
                            <li><a href="/pages/all-posts.html">All posts</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <header class="intro-header" style="background-image: url('/images/keyboard-feature.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>The joys of server ownership</h1>
                        <span class="meta">Posted by
                                <a href="/author/sven-steinbauer.html">Sven Steinbauer</a>
                             on Fri 08 May 2015
                        </span>
                            <span class="meta">Updated on Fri 08 May 2015</span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>This post serves mostly as a &quot;note to self&quot;.</p>
<p>I just ordered myself a super cheap VPS from <a class="reference external" href="http://ramnode.com">Ramnode</a> as I have
a little project I would like to setup and see if I can make it work.</p>
<p>But first I had to setup the server (Debian 7.0) and it's been a while since I've done that, so
some reading was in order to remind myself of all the joys. Thus I decided to note this
down for myself and anyone else who's interested. So it's not an in depth explanation
by any means.</p>
<div class="section" id="securing">
<h2>Securing ##</h2>
<p>I'm not looking for bullet proof as this won't be a production server and won't
hold any sensitive info, but I'd like to know that it's at least somewhat locked
down.</p>
<p>So first off install <a class="reference external" href="http://www.fail2ban.org/wiki/index.php/Main_Page">Fail2ban</a>. This
will lock out users who fail to authenticate too often. Ramnode actually have a
<a class="reference external" href="https://www.youtube.com/watch?v=GmVoqFv_lGU">good video on this</a>. As we'll
only allow key based authentication it's a bit redundant, but if you want to
go that way, there's the info.</p>
<p>Then turn off password authentication for SSH as I'll be using only keys to
authenticate. Edit <code>/etc/ssh/sshd_conf</code> and change the following lines to read:</p>
<div class="highlight"><pre><span></span><span class="go">ChallengeResponseAuthentication no</span>
<span class="go">PasswordAuthentication no</span>
<span class="go">UsePAM no</span>
</pre></div>
<p>Make sure you have uploaded your <a class="reference external" href="https://help.ubuntu.com/community/SSH/OpenSSH/Keys">public key</a> to
<code>~/.ssh/authorized_keys</code> and set the permissions on <code>.ssh</code> and <code>authorized_keys</code> on the
server to <code>700</code> and <code>600</code> respectively.</p>
<p>I also changed the default SSH port to something else, as that already keeps the number of automated
bruteforcers down. Do this by changing the following line in <code>/etc/ssh/sshd_config</code></p>
<div class="highlight"><pre><span></span><span class="go">Port 22</span>
</pre></div>
<p>Set it to anything that doesn't clash with other services. i.e. not 25 or 80 for example.</p>
<p>Once configured <code>sudo service sshd reload</code> to pick up the changes.</p>
<p>So next up <cite>iptables</cite>. I followed <a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-ip-tables-on-ubuntu-12-04">this guide</a>
which gives you a good start. Be sure to run <code>sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT</code> first.
Otherwise you'll end up blocking your current connection and... yeah, ok, I made that mistake.</p>
<p>Then allow what you need and default to dropping the rest. It's all in the URL above, but to re-iterate:</p>
<div class="highlight"><pre><span></span><span class="gp">#</span> Accept connections on port 22
<span class="go">iptables -A INPUT -p tcp --syn --destination-port 22 -j ACCEPT</span>

<span class="gp">#</span> Deny all other input
<span class="go">iptables -A INPUT -p tcp -syn -j DROP</span>
</pre></div>
<p>You will need to run the first line for each port that needs to be able to accept
incoming connections.</p>
<p>I additionally set up <a class="reference external" href="http://www.zeroflux.org/projects/knock">knockd</a> just to play around with it.</p>
<p>To do this edit <code>/etc/knockd.conf</code> and set the port sequences. It should have a default
set for enabling and disabling the ssh port. Edit this to reflect any port changes. If you want to run miltiple commands
for a knock, simply concatenate the command with <code>&amp;&amp;</code>. You can even make one command open
a port for a given time. As we have our <em>keep established connections</em> rule in <code>iptables</code> we
can do</p>
<div class="highlight"><pre><span></span><span class="go">[opencloseSSH]</span>
<span class="go">        sequence      = 2222:udp,3333:tcp,4444:udp</span>
<span class="go">        seq_timeout   = 15</span>
<span class="go">        tcpflags      = syn,ack</span>
<span class="go">        start_command = /usr/sbin/iptables -A INPUT -s %IP% -p tcp --syn --dport 22 -j ACCEPT</span>
<span class="go">        cmd_timeout   = 10</span>
<span class="go">        stop_command  = /usr/sbin/iptables -D INPUT -s %IP% -p tcp --syn --dport 22 -j ACCEPT</span>
</pre></div>
<p>Lifted from the docs. This will allow and block only the IP from where the knock originated.</p>
<p>That's all for now. Postfix next time....</p>
</div>

    </article>


<hr>
<div class="sharing">
</div>
    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://github.com/svenito">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://twitter.com/binaryheadache">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="/post/index.xml">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

<script type="text/javascript">
    var disqus_shortname = 'unlogic';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>